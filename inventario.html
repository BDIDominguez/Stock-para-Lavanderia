<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Inventario</title>

<style>
body{background:#000;color:#fff;margin:0;font-family:Arial;text-align:center;}

#piso{
 width:90%;padding:6px;margin-top:6px;
 font-size:18px;font-weight:bold;border-radius:6px;
 background:#131313;color:#00d7ff;border:2px solid #00aaff;
}

.grid{
 display:grid;
 grid-template-columns:repeat(4,1fr);
 gap:3px;width:96%;margin:6px auto;
}

.box{
 background:#111;padding:3px;border-radius:4px;
 font-size:13px;font-weight:bold;
 display:flex;justify-content:space-between;align-items:center;
}

input{
 width:48%;background:#000;border:1px solid #333;
 font-size:16px;color:#00ff8c;border-radius:4px;text-align:center;
 pointer-events:none; /* evita teclado */
}

/* Campo activo */
.active{
 border:2px solid #00eaff !important;
 background:#003e4f !important;
 color:white !important;
}

.pad{
 display:grid;grid-template-columns:repeat(3,1fr);
 gap:4px;width:96%;margin:auto;margin-top:4px;
}
.pad button{
 padding:14px;font-size:20px;border:none;border-radius:6px;
 background:#222;color:white;font-weight:bold;
}

.ops{
 display:flex;justify-content:space-around;margin-top:15px;
}
.ops button{
 padding:9px 15px;font-size:18px;border:none;border-radius:6px;font-weight:bold;
 background:#333;color:white;
}

.save{background:#00b94d;color:white;width:92%;margin-top:8px;padding:13px;border-radius:8px;font-size:20px}
.back{background:#777;width:92%;margin-top:4px;padding:11px;border-radius:8px;font-size:18px}
</style>
</head>
<body>

<h3 style="margin:6px 0">üì• INVENTARIO POR PISO</h3>

<select id="piso"></select>

<div class="grid">
 <div class="box">B <input id="B"></div>
 <div class="box">T <input id="T"></div>
 <div class="box">P <input id="P"></div>
 <div class="box">SG<input id="SG"></div>

 <div class="box">SCH<input id="SCH"></div>
 <div class="box">F <input id="F"></div>
 <div class="box">K <input id="K"></div>
 <div class="box">3SG<input id="3SG"></div>

 <div class="box">3SCH<input id="3SCH"></div>
 <div class="box">3K<input id="3K"></div>
 <div class="box">OCUP<input id="OC"></div>
</div>

<div class="pad">
 <button onclick="press(1)">1</button><button onclick="press(2)">2</button><button onclick="press(3)">3</button>
 <button onclick="press(4)">4</button><button onclick="press(5)">5</button><button onclick="press(6)">6</button>
 <button onclick="press(7)">7</button><button onclick="press(8)">8</button><button onclick="press(9)">9</button>
 <button onclick="press(0)">0</button><button onclick="clr()">C</button><button onclick="setValue()">SET</button>
</div>

<div class="ops">
 <button onclick="prev()">‚óÄ</button>
 <button onclick="next()">‚ñ∂</button>
</div>

<button class="save" onclick="save()">üíæ GUARDAR</button>
<button class="back" onclick="location.href='index.html'">‚¨Ö VOLVER</button>

<script>
let data={}, campos=["B","T","P","SG","SCH","F","K","3SG","3SCH","3K","OC"], pos=0;

// Cargar base y generar pisos v√°lidos
function load(){
 fetch("./base.txt").then(r=>r.text()).then(t=>{
  t.trim().split("\n").slice(1).forEach(l=>{
   let p=l.split(",")[0];
   piso.innerHTML+=`<option>${p}</option>`;
   if(!data[p])data[p]={B:0,T:0,P:0,SG:0,SCH:0,F:0,K:0,"3SG":0,"3SCH":0,"3K":0,OC:0};
  });
  if(localStorage.getItem("linv")) data = JSON.parse(localStorage.getItem("linv"));
  loadInputs(); highlight();
 });
}

// Cargar valores del piso seleccionado
function loadInputs(){
 let p=piso.value,d=data[p];
 campos.forEach(c=>document.getElementById(c).value=d[c]);
}

// Teclado ‚Äî Reemplazo completo SIEMPRE
function press(v){
 const i=document.getElementById(campos[pos]);
 i.value+=v;   // Como calculadora normal
}

function clr(){document.getElementById(campos[pos]).value="";}

// SET manual r√°pido
function setValue(){
 let v=prompt("Valor nuevo:");
 if(v!==null) document.getElementById(campos[pos]).value=+v;
}

// Guardar todo
function save(){
 let p=piso.value;
 campos.forEach(c=>data[p][c]=+(document.getElementById(c).value||0));
 localStorage.setItem("linv",JSON.stringify(data));
 alert("‚úî Inventario guardado");
}

// Navegaci√≥n entre inputs
function next(){ pos=(pos+1)%campos.length; clearOnSelect(); }
function prev(){ pos=(pos-1+campos.length)%campos.length; clearOnSelect(); }

// üî• Aqu√≠ ocurre el cambio que pediste
function clearOnSelect(){
 campos.forEach(c=>document.getElementById(c).classList.remove("active"));
 let input=document.getElementById(campos[pos]);
 input.classList.add("active");
 //input.value="";  // ‚Üê siempre limpia al seleccionar
 input.select();
}

piso.onchange=loadInputs;

load();
</script>

</body>
</html>
