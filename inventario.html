<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Inventario</title>

<style>
body{background:#000;color:#fff;margin:0;font-family:Arial;text-align:center}

#piso{
 width:90%;padding:6px;margin-top:4px;
 font-size:18px;font-weight:bold;border-radius:6px;
 background:#131313;color:#00d7ff;border:2px solid #00aaff;
}

.grid{
 display:grid;
 grid-template-columns:repeat(4,1fr);
 gap:4px;width:96%;margin:6px auto;
}

.box{
 background:#111;padding:4px;border-radius:4px;
 font-size:14px;font-weight:bold;
 display:flex;justify-content:space-between;align-items:center;
}

.box input{
 width:48%;background:#000;border:1px solid #333;
 font-size:16px;color:#00ff8c;border-radius:4px;text-align:center;
}

.pad{
 display:grid;grid-template-columns:repeat(3,1fr);
 gap:4px;width:96%;margin:auto;margin-top:6px;
}

.pad button{
 padding:14px;font-size:18px;border:none;border-radius:6px;
 background:#222;color:white;font-weight:bold;
}

.ops{
 display:flex;justify-content:space-around;margin-top:6px;
}

.ops button{
 padding:8px 14px;font-size:18px;border:none;border-radius:6px;font-weight:bold;
}

.save{background:#00b94d;color:white;width:92%;margin-top:8px;padding:13px;border-radius:8px;font-size:20px}
.back{background:#777;width:92%;margin-top:4px;padding:11px;border-radius:8px;font-size:18px}
</style>
</head>
<body>

<h3 style="margin:6px 0">ðŸ“¥ INVENTARIO POR PISO</h3>

<select id="piso"></select>

<!-- TODO REDUCIDO Y EN UNA SOLA VISTA -->
<div class="grid">
 <div class="box">B <input id="B"></div>
 <div class="box">T <input id="T"></div>
 <div class="box">P <input id="P"></div>
 <div class="box">SG <input id="SG"></div>

 <div class="box">SCH<input id="SCH"></div>
 <div class="box">F <input id="F"></div>
 <div class="box">K <input id="K"></div>
 <div class="box">3SG<input id="3SG"></div>

 <div class="box">3SCH<input id="3SCH"></div>
 <div class="box">3K<input id="3K"></div>
 <div class="box">OCUP<input id="OC"></div>
</div>

<!-- KEYPAD MINI -->
<div class="pad">
 <button onclick="press(1)">1</button><button onclick="press(2)">2</button><button onclick="press(3)">3</button>
 <button onclick="press(4)">4</button><button onclick="press(5)">5</button><button onclick="press(6)">6</button>
 <button onclick="press(7)">7</button><button onclick="press(8)">8</button><button onclick="press(9)">9</button>
 <button onclick="press(0)">0</button><button onclick="sum()">+ </button><button onclick="clr()">C</button>
</div>

<div class="ops">
 <button onclick="prev()">â—€</button>
 <button onclick="next()">â–¶</button>
 <button style="background:#0077ff;color:white" onclick="setValue()">SET</button>
</div>

<button class="save" onclick="save()">ðŸ’¾ GUARDAR</button>
<button class="back" onclick="location.href='index.html'">â¬… VOLVER</button>


<script>
// VARIABLES
let data={}, campos=["B","T","P","SG","SCH","F","K","3SG","3SCH","3K","OC"], pos=0, modoSum=false;

// CARGA BASE + INVENTARIO EXISTENTE
async function load(){
 fetch("./base.txt").then(r=>r.text()).then(txt=>{
  txt.trim().split("\n").slice(1).forEach(l=>{
   let p=l.split(",")[0];
   piso.innerHTML+=`<option>${p}</option>`;
   if(!data[p]) data[p]={B:0,T:0,P:0,SG:0,SCH:0,F:0,K:0,"3SG":0,"3SCH":0,"3K":0,OC:0};
  });

  if(localStorage.getItem("linv"))
   data=JSON.parse(localStorage.getItem("linv"));

  loadInputs();
 });
}

// MUESTRA DATOS DEL PISO SELECCIONADO
function loadInputs(){
 let p=piso.value,d=data[p];
 campos.forEach(c=>document.getElementById(c).value=d[c]);
}

// INGRESAR NÃšMEROS
function press(v){
 let box=document.getElementById(campos[pos]);
 if(modoSum){ box.value=(+box.value)+(+v); modoSum=false; }
 else box.value=v;          // ðŸ”¥ YA NO ACUMULA â€” reemplaza inmediato
}

function sum(){ modoSum=true; }     // Activa suma real (+)
function clr(){ document.getElementById(campos[pos]).value=""; }

// SET â†’ fija un valor manual sin errores
function setValue(){
 let v=prompt("Nuevo valor:");
 if(v!==null){
  document.getElementById(campos[pos]).value = +v;
 }
}

// GUARDAR
function save(){
 let p=piso.value;
 campos.forEach(c=>data[p][c]=+(document.getElementById(c).value||0))
 localStorage.setItem("linv",JSON.stringify(data))
 alert("âœ” Guardado")
}

// NavegaciÃ³n entre campos
function next(){pos=(pos+1)%campos.length;highlight();}
function prev(){pos=(pos-1+campos.length)%campos.length;highlight();}
function highlight(){document.getElementById(campos[pos]).focus();}

piso.onchange=loadInputs;
load();
</script>
</body>
</html>
